<!DOCTYPE html>
<html lang="es">
  </audio>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home</title>
    <link rel="stylesheet" href="css/home.css" />
  </head>
  <body>
    <div class="floating-particles" id="particles"></div>
    <div class="stars" id="stars"></div>

    <div class="home-container">
      <div class="welcome-section">
        <p class="welcome-text">¡Bienvenido crack!</p>
        <div class="username-container">
          <h1 class="username-animated" id="username"></h1>
        </div>
        <p class="subtitle">Selecciona una opción para continuar</p>
      </div>



      
      <div class="endpoints-container">
        <button class="endpoint-button" onclick="callEndpoint('juegos_baratos')">
          Juegos Baratos
        </button>
        <button class="endpoint-button" onclick="callEndpoint('juegos_caros')">
          Juegos Caros
        </button>


        <button class="logout" onclick="cerrarSesion()">
          <a href="home.html" class="logout" onclick="cerrarSesion()">
            <img
              src="https://img.icons8.com/?size=100&id=59781&format=png&color=000000"
              alt="Salir"
              class="icono-logout"
            />
          </a>
        </button>

        <div id="endpoint-data" style="margin-top: 2rem; color: #64ffda;"></div>
      </div>


    <select id="categoriaSelect" onchange="filtrarPorCategoria()">
      <option value="">Seleccionar categoría</option>
      <option value="Acción">Acción</option>
      <option value="RPG">RPG</option>
      <option value="Aventura">Aventura</option>
    </select>





    </div>

    <script>
  // Reemplaza el script completo en home.html con este código actualizado

const nombreUsuario = localStorage.getItem("usuarioNombre");
if (nombreUsuario) {
  document.getElementById("username").textContent = nombreUsuario;
} else {
  window.location.href = "index.html";
}

// Cargar categorías al iniciar la página
async function cargarCategorias() {
  const token = localStorage.getItem("token");
  try {
    const res = await fetch("http://localhost:3000/categorias", {
      headers: { "Authorization": `Bearer ${token}` }
    });
    
    if (!res.ok) {
      throw new Error("Error al cargar categorías");
    }
    
    const categorias = await res.json();
    const select = document.getElementById("categoriaSelect");
    
    // Limpiar opciones existentes excepto la primera
    select.innerHTML = '<option value="">Seleccionar categoría</option>';
    
    // Agregar cada categoría como opción
    categorias.forEach(cat => {
      const option = document.createElement("option");
      option.value = cat;
      option.textContent = cat;
      select.appendChild(option);
    });
  } catch (err) {
    console.error("Error al cargar categorías:", err);
    alert("No se pudieron cargar las categorías");
  }
}

function cerrarSesion() {
  localStorage.clear();
  sessionStorage.clear();
  window.location.href = "index.html";
}

function callEndpoint(endpointName) {
  const button = event.target.closest(".endpoint-button");
  const originalText = button.innerHTML;

  button.innerHTML = '<span class="endpoint-icon">⏳</span>Cargando...';
  button.style.pointerEvents = "none";
  button.style.opacity = "0.7";

  const token = localStorage.getItem("token");
  fetch(`http://localhost:3000/${endpointName}`, {
    headers: { "Authorization": `Bearer ${token}` }
  })
    .then((res) => res.json())
    .then((data) => {
      button.innerHTML = originalText;
      button.style.pointerEvents = "auto";
      button.style.opacity = "1";

      const container = document.getElementById("endpoint-data");
      if (data.length === 0) {
        container.innerHTML = "<p>No se encontraron resultados.</p>";
        return;
      }

      let tableHTML = '<table class="data-table">';
      tableHTML += "<thead><tr>";

      Object.keys(data[0]).forEach((key) => {
        const displayName = key.charAt(0).toUpperCase() + key.slice(1).replace('_', ' ');
        tableHTML += `<th>${displayName}</th>`;
      });
      tableHTML += "</tr></thead><tbody>";

      data.forEach((item) => {
        tableHTML += "<tr>";
        Object.entries(item).forEach(([key, value]) => {
          let cellClass = '';
          let displayValue = value;
          
          if (key.toLowerCase().includes('precio') || key.toLowerCase().includes('price')) {
            cellClass = 'price';
            if (typeof value === 'number') {
              displayValue = `$${value.toLocaleString()}`;
            }
          } else if (key.toLowerCase().includes('nombre') || 
                    key.toLowerCase().includes('name') || 
                    key.toLowerCase().includes('titulo') ||
                    key.toLowerCase().includes('title')) {
            cellClass = 'name';
          } else if (key.toLowerCase().includes('categoria') || 
                    key.toLowerCase().includes('category') || 
                    key.toLowerCase().includes('genero') ||
                    key.toLowerCase().includes('genre')) {
            cellClass = 'category';
          }
          
          tableHTML += `<td class="${cellClass}">${displayValue}</td>`;
        });
        tableHTML += "</tr>";
      });

      tableHTML += "</tbody></table>";
      container.innerHTML = tableHTML;
    })
    .catch((err) => {
      button.innerHTML = originalText;
      button.style.pointerEvents = "auto";
      button.style.opacity = "1";
      console.error(err);
      alert("Ocurrió un error al llamar al endpoint");
    });
}

async function filtrarPorCategoria() {
  const categoria = document.getElementById("categoriaSelect").value;
  if (!categoria) {
    document.getElementById("endpoint-data").innerHTML = "";
    return;
  }

  const token = localStorage.getItem("token");
  const res = await fetch(`http://localhost:3000/juegos/categoria/${categoria}`, {
    headers: { "Authorization": `Bearer ${token}` }
  });
  const data = await res.json();

  const container = document.getElementById("endpoint-data");
  if (!Array.isArray(data)) {
    container.innerHTML = "<p>No se encontraron juegos en esta categoría.</p>";
    return;
  }

  let tableHTML = "<table class='data-table'><thead><tr><th>Título</th><th>Precio</th><th>Disponible</th></tr></thead><tbody>";
  data.forEach(j => {
    const disponible = j.disponible ? "Sí" : "No";
    tableHTML += `<tr><td class="name">${j.titulo}</td><td class="price">$${j.precio}</td><td>${disponible}</td></tr>`;
  });
  tableHTML += "</tbody></table>";
  container.innerHTML = tableHTML;
}

// Crear partículas flotantes
function createParticles() {
  const particlesContainer = document.getElementById("particles");

  for (let i = 0; i < 20; i++) {
    const particle = document.createElement("div");
    particle.className = "particle";

    const size = Math.random() * 4 + 2;
    const startPosition = Math.random() * 100;
    const animationDelay = Math.random() * 25;

    particle.style.width = size + "px";
    particle.style.height = size + "px";
    particle.style.left = startPosition + "%";
    particle.style.animationDelay = animationDelay + "s";

    particlesContainer.appendChild(particle);
  }
}

// Crear estrellas parpadeantes
function createStars() {
  const starsContainer = document.getElementById("stars");

  for (let i = 0; i < 50; i++) {
    const star = document.createElement("div");
    star.className = "star";

    star.style.left = Math.random() * 100 + "%";
    star.style.top = Math.random() * 100 + "%";
    star.style.animationDelay = Math.random() * 3 + "s";

    starsContainer.appendChild(star);
  }
}

// Inicializar efectos y cargar categorías
createParticles();
createStars();
cargarCategorias(); // ← Llamada importante para cargar las categorías

// Agregar efecto de click en el nombre de usuario
document.getElementById("username").addEventListener("click", function () {
  this.style.animation = "none";
  setTimeout(() => {
    this.style.animation =
      "gradientShift 3s ease-in-out infinite, rotate360 4s linear infinite, bounce 2s ease-in-out infinite, glow 2s ease-in-out infinite alternate";
  }, 100);
});
    </script>
  </body>
</html>
